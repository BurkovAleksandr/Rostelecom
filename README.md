# Async Equipment Provisioning Service

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π.

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- **Service B** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π HTTP API, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Ö —Å—Ç–∞—Ç—É—Å;
- **Worker** ‚Äî —Å–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç;
- **Service A (stub)** ‚Äî –∑–∞–≥–ª—É—à–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, —Å–∏–º—É–ª–∏—Ä—É—é—â–∞—è –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥;
- **Redis** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–∞–¥–∞—á;
- **RabbitMQ** ‚Äî –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π.

---
## –î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

–ù–∞ –¥–∏–∞–≥—Ä–∞–º–º–µ –Ω–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω –ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

```mermaid
sequenceDiagram
    participant Client
    participant Service B
    participant RabbitMQ
    participant Redis
    participant Worker
    participant Service A

    %% --- –§–∞–∑–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ---
    Client->>+Service B: POST /api/v1/equipment/cpe/{id} (—Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É)
    Service B->>RabbitMQ: publish(—Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–∞—á–µ–π –≤ tasks_queue)
    Service B->>Redis: SETEX(task_id, status="pending")
    Service B-->>-Client: 200 OK ({"taskId": "..."})

    %% --- –§–∞–∑–∞ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ –í–æ—Ä–∫–µ—Ä–æ–º ---
    Worker->>RabbitMQ: consume(—Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ tasks_queue)
    Worker->>+Service A: POST /api/v1/equipment/cpe/{id} (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é)
    Note over Service A: –ñ–¥–µ—Ç 60 —Å–µ–∫—É–Ω–¥...
    Service A-->>-Worker: 200 OK ({"message": "success"})
    Worker->>RabbitMQ: publish(—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ results_queue)
    
    %% --- –§–∞–∑–∞ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –°–µ—Ä–≤–∏—Å–µ B ---
    Note over Service B: –§–æ–Ω–æ–≤—ã–π consumer —Å–ª—É—à–∞–µ—Ç results_queue
    Service B->>RabbitMQ: consume(—Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º)
    Service B->>Redis: SET(task_id, status="completed", result)

    %% --- –§–∞–∑–∞ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ö–ª–∏–µ–Ω—Ç–æ–º ---
    Client->>+Service B: GET /api/v1/equipment/cpe/{id}/task/{task_id}
    Service B->>Redis: GET(task_id)
    Service B-->>-Client: 200 OK ({"message": "Completed"})
```

## –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
*   **Service A**: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å-–∑–∞–≥–ª—É—à–∫–∞...
*   **Service B**: –û—Å–Ω–æ–≤–Ω–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API...
*   **Worker**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–¥–∞—á –∏–∑ –æ—á–µ—Ä–µ–¥–∏...
*   **RabbitMQ**: –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π...
*   **Redis**: –•—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á...


## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
1. git clone https://github.com/BurkovAleksandr/Rostelecom.git
2. cd Rostelecom
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
3. cd service_b/cert
4. openssl req -x509 -newkey rsa:2048 -nodes   -keyout ./key.pem -out ./cert.pem -days 365

–ó–∞–ø—É—Å–∫:
5. docker compose up --build
```
